# 작업 로그 - 2026-02-06

## 완료: 날짜 선택 기능 + 등록 후 플로우 개선

### 구현 내용

#### 1. DayCell - selectable/isSelected props 추가
- `selectable` prop: `true`일 때 거래 없는 날짜도 터치 가능
- `isSelected` prop: 선택된 날짜에 파란 배경(#BBDEFB) 스타일 적용
- 기존 동작 유지 (props 생략 시 기존과 동일)

#### 2. CalendarGrid - selectable/selectedDay props 전달
- `selectable`, `selectedDay` props를 DayCell로 전달
- 기존 동작 변경 없음

#### 3. DatePickerModal 신규 컴포넌트
- Modal + CalendarHeader + CalendarGrid (selectable 모드) 조합
- 월 이동 (이전/다음) 지원, 연도 경계 처리
- 날짜 선택 시 `onDateSelect` 콜백, 취소 버튼

#### 4. DateSelector 신규 컴포넌트
- "오늘" / "어제" / "직접 선택" 3버튼 UI
- 선택된 날짜 표시: "2026년 2월 6일 (금)" 형식
- "직접 선택" → DatePickerModal 열기
- 선택 상태에 따라 active 스타일 자동 적용

#### 5. Navigation 타입 수정
- `Home: { selectedDate?: string } | undefined` — 'YYYY-MM-DD' 형식

#### 6. AddTransactionScreen 수정
- DateSelector 통합 (금액 입력 위에 배치)
- 거래 생성 시 `selectedDate` 사용 (`new Date()` 대신)
- "확인" → `navigation.navigate('Home', { selectedDate: 'YYYY-MM-DD' })`
- "계속 등록하기" → 금액/메모 초기화 + 날짜를 오늘로 리셋

#### 7. HomeScreen 라우트 파라미터 처리
- `route.params?.selectedDate` 감지
- 캘린더 뷰로 전환 + 해당 월로 이동 + DayDetailModal 자동 열기
- 파라미터 소비 후 클리어 (`setParams({ selectedDate: undefined })`)

### 테스트 결과
- **228개 테스트 전체 통과**
- **커버리지**: Stmts 91.54% / Branches 91.63% / Functions 87.05% / Lines 91.51%
- 신규 컴포넌트 (DatePickerModal, DateSelector): **100% 커버리지**

### 수정 파일 목록
| 구분 | 파일 |
|------|------|
| 수정 | `src/views/components/DayCell.tsx` |
| 수정 | `src/views/components/CalendarGrid.tsx` |
| 신규 | `src/views/components/DatePickerModal.tsx` |
| 신규 | `src/views/components/DateSelector.tsx` |
| 수정 | `src/types/navigation.ts` |
| 수정 | `src/views/screens/AddTransactionScreen.tsx` |
| 수정 | `src/views/screens/HomeScreen.tsx` |
| 수정 | `__tests__/components/DayCell.test.tsx` |
| 수정 | `__tests__/components/CalendarGrid.test.tsx` |
| 신규 | `__tests__/components/DatePickerModal.test.tsx` |
| 신규 | `__tests__/components/DateSelector.test.tsx` |
| 수정 | `__tests__/screens/AddTransactionScreen.test.tsx` |
| 수정 | `__tests__/screens/HomeScreen.test.tsx` |

---

## 완료: 통계 페이지 (Statistics Tab) 추가

### 구현 내용

#### 1. 타입 정의 추가
- `PeriodType`, `PeriodSummary`, `CategoryBreakdown`, `PaymentMethodBreakdown` 타입 추가
- Navigation에 `Statistics` 라우트 및 `StatisticsScreenProps` 추가

#### 2. TransactionService 집계 메서드 (TDD)
- `getMonthlySummary(year, month)`: 월별 수입/지출/잔액/거래수 반환
- `getYearlySummary(year)`: 연도별 수입/지출/잔액/거래수 반환
- `getCategoryBreakdown(startDate, endDate, type?)`: 카테고리별 금액/비율 집계
- `getPaymentMethodBreakdown(startDate, endDate, type?)`: 결제수단별 금액/비율 집계

#### 3. PeriodSelector 신규 컴포넌트
- "월별" / "연도별" 토글 (ViewToggle 스타일)
- ◀ `2026년 2월` ▶ / ◀ `2026년` ▶ 네비게이션

#### 4. BreakdownList 신규 컴포넌트
- 카테고리/결제수단별 항목 리스트 (아이콘, 이름, 건수, 금액, 비율 바)
- 빈 상태 처리 ("데이터가 없습니다")

#### 5. StatisticsScreen 신규 화면
- PeriodSelector + SummaryCard(재사용) + BreakdownList×2 조합
- 월별/연도별 전환, 이전/다음 기간 네비게이션
- useFocusEffect 패턴으로 데이터 로딩

#### 6. App.tsx 탭 추가
- 탭 순서: 홈 → 추가 → **통계** → 설정

### 테스트 결과
- **271개 테스트 전체 통과** (기존 228 + 신규 43)
- **커버리지**: Stmts 92.69% / Branches 91.51% / Functions 89.32% / Lines 92.58%
- 서비스 레이어: **100%**, 컴포넌트: **100%**, StatisticsScreen: 95.55%

### 수정 파일 목록
| 구분 | 파일 |
|------|------|
| 수정 | `src/types/index.ts` |
| 수정 | `src/types/navigation.ts` |
| 수정 | `src/services/interfaces/ITransactionService.ts` |
| 수정 | `src/services/TransactionService.ts` |
| 수정 | `__tests__/services/TransactionService.test.ts` |
| 신규 | `src/views/components/PeriodSelector.tsx` |
| 신규 | `__tests__/components/PeriodSelector.test.tsx` |
| 신규 | `src/views/components/BreakdownList.tsx` |
| 신규 | `__tests__/components/BreakdownList.test.tsx` |
| 신규 | `src/views/screens/StatisticsScreen.tsx` |
| 신규 | `__tests__/screens/StatisticsScreen.test.tsx` |
| 수정 | `App.tsx` |

---

## 완료: Expo SDK 54 업그레이드 및 의존성 안정화

### 구현 내용

#### 1. Expo SDK 52 → 54 업그레이드
- `expo`: ~52.0.0 → ~54.0.33
- `react`: 18.3.1 → 19.1.0
- `react-dom`: 18.3.1 → 19.1.0
- `react-native`: 0.76.5 → 0.81.5
- `expo-status-bar`: ~2.0.0 → ~3.0.9
- `expo-asset`: ~11.0.1 → ~12.0.12
- `expo-font`: ~13.0.1 → ~14.0.11
- `@expo/metro-runtime`: ~4.0.1 → ~6.1.2

#### 2. 의존성 버전 안정화
- `react-native-safe-area-context`: 4.12.0 → 5.6.2
- `react-native-screens`: ~4.4.0 → ~4.16.0
- `react-native-web`: ~0.19.13 → ~0.21.2
- `typescript`: ~5.3.0 → ~5.9.2
- `jest-expo`: ~52.0.0 → ~54.0.17
- `react-test-renderer`: ^18.3.1 → 19.1.0
- `@types/react`: ~18.3.0 → ~19.1.0
- `@types/jest`: ^30.0.0 → ^29.5.14 (jest 29.x에 맞게 다운그레이드)

#### 3. 제거된 패키지
- `@testing-library/jest-native` (deprecated, @testing-library/react-native 내장 매처로 대체)

#### 4. 보안 취약점 해결
- `tar` 관련 high severity 취약점 4건 → Expo 54 업그레이드로 전체 해결 (0 vulnerabilities)

### 테스트 결과
- **271개 테스트 전체 통과** (변경 없음)
- `npx expo-doctor`: 패키지 호환성 체크 **전체 통과**

### 수정 파일 목록
| 구분 | 파일 |
|------|------|
| 수정 | `package.json` |
| 수정 | `package-lock.json` |

---

## 기타 TODO

### Phase 1.5 남은 작업
- [ ] 테마 시스템 (Light/Dark 모드)

### Phase 2: AsyncStorage 연동
- [ ] @react-native-async-storage/async-storage 설치
- [ ] StorageService 구현
- [ ] 서비스 레이어 연동
